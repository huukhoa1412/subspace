while [ $qty -gt 1 ]
do
#version
#local subspace_version=`wget -qO- https://api.github.com/repos/subspace/subspace/releases/latest | jq -r ".tag_name"`
#create dir and config
if [ ! -d $HOME/subspace${qty} ]; then
mkdir $HOME/subspace${qty}
fi
cd $HOME/subspace${qty}
sleep 1
 # Create script 
 tee $HOME/subspace${qty}/docker-compose.yml > /dev/null <<EOF
  version: "3.7"
  services:
    node:
      image: ghcr.io/subspace/node:$version
      volumes:
        - node-data:/var/subspace:rw
      ports:
        - "0.0.0.0:3${qty}333:3${qty}333"
        - "0.0.0.0:3${qty}433:3${qty}433"
      restart: unless-stopped
      command: [
        "--chain", "gemini-3c",
        "--base-path", "/var/subspace",
        "--execution", "wasm",
        "--blocks-pruning", "archive",
        "--state-pruning", "archive",
        "--port", "3${qty}333",
        "--dsn-listen-on", "/ip4/0.0.0.0/tcp/34433",
        "--rpc-cors", "all",
        "--rpc-methods", "safe",
        "--unsafe-ws-external",
        "--dsn-disable-private-ips",
        "--no-private-ipv4",
        "--validator",
        "--name", "$SUBSPACE_NODE_NAME"
      ]
      healthcheck:
        timeout: 5s
        interval: 30s
        retries: 5

    farmer:
      depends_on:
        node:
          condition: service_healthy
      image: ghcr.io/subspace/farmer:$version
      volumes:
        - farmer-data:/var/subspace:rw
      ports:
        - "0.0.0.0:3${qty}533:3${qty}533"
      restart: unless-stopped
      command: [
        "--base-path", "/var/subspace",
        "farm",
        "--disable-private-ips",
        "--node-rpc-url", "ws://node:9944",
        "--listen-on", "/ip4/0.0.0.0/tcp/3${qty}533",
        "--reward-address", "$SUBSPACE_WALLET_ADDRESS",
        "--plot-size", "$SUBSPACE_PLOT_SIZE"
      ]
  volumes:
    node-data:
    farmer-data:
EOF
sleep 2
#docker run
docker compose up -d
qty=$[ $qty - 1 ]
done




###########################
#create catalog and config#
###########################
echo $QNODE
while [ $QNODE -gt 1 ]
do
#create dir and config
if [ ! -d $HOME/subspace$QNODE ]; then
mkdir $HOME/subspace$QNODE
fi
cd $HOME/subspace$QNODE
sleep 1
 # Create script 
 tee $HOME/subspace$QNODE/docker-compose.yml > /dev/null <<EOF
  version: "3.7"
  services:
    node:
      image: ghcr.io/subspace/node:$version
      volumes:
        - node-data:/var/subspace:rw
      ports:
        - "0.0.0.0:3${QNODE}333:3${QNODE}333"
        - "0.0.0.0:3${QNODE}433:3${QNODE}433"
      restart: unless-stopped
      command: [
        "--chain", "gemini-3c",
        "--base-path", "/var/subspace",
        "--execution", "wasm",
        "--blocks-pruning", "archive",
        "--state-pruning", "archive",
        "--port", "3${QNODE}333",
        "--dsn-listen-on", "/ip4/0.0.0.0/tcp/34433",
        "--rpc-cors", "all",
        "--rpc-methods", "safe",
        "--unsafe-ws-external",
        "--dsn-disable-private-ips",
        "--no-private-ipv4",
        "--validator",
        "--name", "$SUBSPACE_NODE_NAME$QNODE"
      ]
      healthcheck:
        timeout: 5s
        interval: 30s
        retries: 5

    farmer:
      depends_on:
        node:
          condition: service_healthy
      image: ghcr.io/subspace/farmer:$version
      volumes:
        - farmer-data:/var/subspace:rw
      ports:
        - "0.0.0.0:3${QNODE}533:3${QNODE}533"
      restart: unless-stopped
      command: [
        "--base-path", "/var/subspace",
        "farm",
        "--disable-private-ips",
        "--node-rpc-url", "ws://node:9944",
        "--listen-on", "/ip4/0.0.0.0/tcp/3${QNODE}533",
        "--reward-address", "$SUBSPACE_WALLET_ADDRESS$QNODE",
        "--plot-size", "$SUBSPACE_PLOT_SIZE$QNODE"
      ]
  volumes:
    node-data:
    farmer-data:
EOF
sleep 2
#docker run
docker compose up -d
QNODE=$[ $QNODE - 1 ]
done